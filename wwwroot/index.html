<!DOCTYPE html>
<html>
  <head>
    <script src="./js/lib/signalr.min.js"></script>

  </head>
  <body>
    <div>
      <input type="text" id="user">
    </div>
    <div>
      <input type="text" id="msg">
    </div>
    <div>
      <button id="btn-send">Send</button>
    </div>
    <hr>
    <div>
      <ul id="messages"></ul>
    </div>
    <script>
      var connection = new signalR.HubConnectionBuilder().withUrl("/chatHub").build();

      //Disable send button until connection is established
      document.getElementById("btn-send").disabled = true;

      connection.on("ReceiveMessage", function (user, message) {
          var msg = message.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
          var encodedMsg = user + " says " + msg;
          var li = document.createElement("li");
          li.textContent = encodedMsg;
          document.getElementById("messages").appendChild(li);
      });

      connection.start().then(function () {
          document.getElementById("btn-send").disabled = false;
      }).catch(function (err) {
          return console.error(err.toString());
      });

      document.getElementById("btn-send").addEventListener("click", function (event) {
          var user = document.getElementById("user").value;
          var message = document.getElementById("msg").value;
          connection.invoke("SendMessage", user, message).catch(function (err) {
              return console.error(err.toString());
          });
          event.preventDefault();
      });
    </script>
  </body>
</html>